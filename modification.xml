<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
	This is an example modification file for SMF packages.

	ATTENTION: If you are trying to install this manually, you should try
	the package manager.  If it will not work for you, please take a look
	at the following for information on this format:
		http://mods.simplemachines.org/docs/manual-install.php

================================================================================

	Modification files can be used to modify files so that they do what
	your package needs them to do to work properly.

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>digger:NiceTooltips</id>
	<version>1.9</version>

<!-- Main code -->

	<file name="$sourcedir/Subs.php">

		<operation>

			<search position="end" />

			<add><![CDATA[
// * NiceTooltips mod
function NiceTooltip($body, $caption='', $smileys=true, $cache_id='')
{
	global $context, $settings, $modSettings;

	// Is it disabled or empty? Check permission.
	if ((allowedTo('disable_nicetooltips') && empty($context['user']['is_admin'])) || empty($modSettings['NiceTooltips_lenght']) || empty($body)) return ' title="' . $caption . '" ';

	// Send overlib headers.
	if (empty($context['overlib_loaded']))
	{
	  $context['html_headers'] .= '
	<style type="text/css">
	.nice_tooltip_fgclass {
	text-align: left;
	background-color: ' . $modSettings['NiceTooltips_FGCOLOR'] . ';
	opacity: ' . $modSettings['NiceTooltips_OPACITY'] / 100 . ';
	}
	.nice_tooltip_bgclass {
	background-color: ' . $modSettings['NiceTooltips_BGCOLOR'] . ';
	opacity: ' . $modSettings['NiceTooltips_OPACITY'] / 100 . ';
	}
	</style>';
  	$context['html_headers'] .=	'
	<script language="JavaScript" type="text/javascript" src="' . $settings['default_theme_url'] . (!empty($modSettings['NiceTooltips_scripturl']) ? '/' . $modSettings['NiceTooltips_scripturl'] : '') .	'/overlib_mini.js"></script>';
    $context['html_headers'] .=	'
	<script language="JavaScript" type="text/javascript" src="' . $settings['default_theme_url'] . (!empty($modSettings['NiceTooltips_scripturl']) ? '/' . $modSettings['NiceTooltips_scripturl'] : '') . '/overlib_adaptive_width.js"></script>';
    $context['overlib_loaded'] = true;
	}

	// Censored?
	if (!empty($modSettings['NiceTooltips_censored']))
	{
  	censorText($body);
  	censorText($caption);
  }

	// Parse html code and smiles, replace unwanted entities.
	$body = htmlspecialchars(addslashes(parse_bbc($body, $smileys, $cache_id)));
	$caption = htmlspecialchars(addslashes($caption));

 	// Make a tooltip.
	$tooltip = ' onmouseover="return overlib(\''. $body .	'\',
	FGCLASS,\'' . 'nice_tooltip_fgclass' . '\',
	BGCLASS,\'' . 'nice_tooltip_bgclass' . '\',
	TEXTCOLOR,\'' . $modSettings['NiceTooltips_TEXTCOLOR'] . '\',
	TEXTSIZE,\'' . $modSettings['NiceTooltips_TEXTSIZE'] . '\',
	CAPCOLOR,\'' . $modSettings['NiceTooltips_CAPCOLOR'] . '\',
	DELAY,'. $modSettings['NiceTooltips_DELAY'] .',
	CAPTION,\'' . $caption . '\',
	CELLPAD,4,ADAPTIVE_WIDTH,HAUTO,VAUTO)" onmouseout="return nd();" ';

	unset($caption, $body);
	return $tooltip;
}
// NiceTooltips mod *
]]></add>
					
		</operation>

 	</file>
 		
</modification>
